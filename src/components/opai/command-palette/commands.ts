import {
  Grid3x3,
  FileText,
  Building2,
  Calculator,
  ClipboardList,
  Settings,
  Users,
  CalendarDays,
  UserRoundCheck,
  Receipt,
  Clock3,
  Fingerprint,
  ShieldAlert,
  Route,
  Moon,
  Ticket,
  Package,
  ClipboardCheck,
  Shield,
  DollarSign,
  TrendingUp,
  Contact,
  MapPin,
  Plug,
  Bell,
  Wallet,
  BarChart3,
  Plus,
  UserPlus,
  FilePlus,
  Download,
  Landmark,
  BookText,
  Bot,
  FolderOpen,
  PenLine,
  FolderTree,
  Layers,
  type LucideIcon,
} from 'lucide-react';
import type { CommandItem } from './types';
import { hasAppAccess } from '@/lib/app-access';
import {
  hasAnyConfigSubmoduleAccess,
  hasConfigSubmoduleAccess,
  hasCrmSubmoduleAccess,
  hasDocsSubmoduleAccess,
} from '@/lib/module-access';

// ── Navegación principal ──

const navigationCommands: CommandItem[] = [
  {
    id: 'nav-hub',
    label: 'Inicio',
    description: 'Dashboard principal',
    category: 'navigation',
    icon: Grid3x3,
    href: '/hub',
    keywords: ['home', 'dashboard', 'inicio', 'principal'],
    canShow: (role) => hasAppAccess(role, 'hub'),
  },
  {
    id: 'nav-notificaciones',
    label: 'Notificaciones',
    description: 'Centro de notificaciones',
    category: 'navigation',
    icon: Bell,
    href: '/opai/notificaciones',
    keywords: ['alertas', 'avisos', 'notifications'],
  },
  {
    id: 'nav-documentos',
    label: 'Documentos',
    description: 'Gestión de documentos y envíos',
    category: 'navigation',
    icon: FileText,
    href: '/opai/inicio',
    keywords: ['docs', 'propuestas', 'presentaciones', 'envios'],
    canShow: (role) => hasDocsSubmoduleAccess(role, 'overview'),
  },
  {
    id: 'nav-documentos-gestion',
    label: 'Gestión de Documentos',
    description: 'Administrar documentos',
    category: 'navigation',
    icon: FolderOpen,
    href: '/opai/documentos',
    keywords: ['archivos', 'carpetas', 'gestion'],
    canShow: (role) => hasDocsSubmoduleAccess(role, 'overview'),
  },

  // CRM
  {
    id: 'nav-crm',
    label: 'Comercial',
    description: 'Módulo CRM',
    category: 'navigation',
    icon: Building2,
    href: '/crm',
    keywords: ['crm', 'comercial', 'ventas'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'overview'),
  },
  {
    id: 'nav-crm-leads',
    label: 'Leads',
    description: 'Prospectos y oportunidades',
    category: 'navigation',
    icon: Users,
    href: '/crm/leads',
    keywords: ['prospectos', 'oportunidades', 'leads'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'leads'),
  },
  {
    id: 'nav-crm-accounts',
    label: 'Cuentas',
    description: 'Cuentas de clientes',
    category: 'navigation',
    icon: Building2,
    href: '/crm/accounts',
    keywords: ['clientes', 'empresas', 'cuentas'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'accounts'),
  },
  {
    id: 'nav-crm-installations',
    label: 'Instalaciones',
    description: 'Puntos de servicio',
    category: 'navigation',
    icon: MapPin,
    href: '/crm/installations',
    keywords: ['puestos', 'ubicaciones', 'sitios'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'installations'),
  },
  {
    id: 'nav-crm-deals',
    label: 'Negocios',
    description: 'Pipeline de negocios',
    category: 'navigation',
    icon: TrendingUp,
    href: '/crm/deals',
    keywords: ['oportunidades', 'ventas', 'pipeline'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'deals'),
  },
  {
    id: 'nav-crm-contacts',
    label: 'Contactos',
    description: 'Contactos de clientes',
    category: 'navigation',
    icon: Contact,
    href: '/crm/contacts',
    keywords: ['personas', 'contactos'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'contacts'),
  },
  {
    id: 'nav-crm-cotizaciones',
    label: 'Cotizaciones',
    description: 'Presupuestos y cotizaciones',
    category: 'navigation',
    icon: DollarSign,
    href: '/crm/cotizaciones',
    keywords: ['quotes', 'presupuestos', 'cpq'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'quotes'),
  },

  // Payroll
  {
    id: 'nav-payroll',
    label: 'Payroll',
    description: 'Remuneraciones y nómina',
    category: 'navigation',
    icon: Calculator,
    href: '/payroll',
    keywords: ['liquidaciones', 'nomina', 'sueldos', 'remuneraciones'],
    canShow: (role) => hasAppAccess(role, 'payroll'),
  },
  {
    id: 'nav-payroll-periodos',
    label: 'Períodos de Pago',
    description: 'Gestión de períodos de liquidación',
    category: 'navigation',
    icon: CalendarDays,
    href: '/payroll/periodos',
    keywords: ['liquidacion', 'periodo', 'mensual'],
    canShow: (role) => hasAppAccess(role, 'payroll'),
  },
  {
    id: 'nav-payroll-anticipos',
    label: 'Anticipos',
    description: 'Anticipos de sueldo',
    category: 'navigation',
    icon: Wallet,
    href: '/payroll/anticipos',
    keywords: ['adelanto', 'anticipo'],
    canShow: (role) => hasAppAccess(role, 'payroll'),
  },

  // Operaciones
  {
    id: 'nav-ops',
    label: 'Operaciones',
    description: 'Centro de operaciones',
    category: 'navigation',
    icon: ClipboardList,
    href: '/ops',
    keywords: ['operaciones', 'ops', 'turnos', 'asistencia'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-pauta-mensual',
    label: 'Pauta Mensual',
    description: 'Programación mensual de turnos',
    category: 'navigation',
    icon: CalendarDays,
    href: '/ops/pauta-mensual',
    keywords: ['calendario', 'programacion', 'mes'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-pauta-diaria',
    label: 'Pauta Diaria',
    description: 'Control de asistencia diaria',
    category: 'navigation',
    icon: UserRoundCheck,
    href: '/ops/pauta-diaria',
    keywords: ['asistencia', 'hoy', 'diario'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-turnos-extra',
    label: 'Turnos Extra',
    description: 'Gestión de turnos extraordinarios',
    category: 'navigation',
    icon: Receipt,
    href: '/ops/turnos-extra',
    keywords: ['extra', 'extraordinario', 'adicional'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-refuerzos',
    label: 'Turnos de Refuerzo',
    description: 'Refuerzos y coberturas',
    category: 'navigation',
    icon: Clock3,
    href: '/ops/refuerzos',
    keywords: ['refuerzo', 'cobertura', 'reemplazo'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-marcaciones',
    label: 'Marcaciones',
    description: 'Control de marcaciones',
    category: 'navigation',
    icon: Fingerprint,
    href: '/ops/marcaciones',
    keywords: ['reloj', 'control', 'entrada', 'salida'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-ppc',
    label: 'PPC',
    description: 'Plan de prevención y control',
    category: 'navigation',
    icon: ShieldAlert,
    href: '/ops/ppc',
    keywords: ['prevencion', 'seguridad', 'plan'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-rondas',
    label: 'Rondas',
    description: 'Monitoreo de rondas de vigilancia',
    category: 'navigation',
    icon: Route,
    href: '/ops/rondas',
    keywords: ['vigilancia', 'recorrido', 'patrulla'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-control-nocturno',
    label: 'Control Nocturno',
    description: 'Control de turnos nocturnos',
    category: 'navigation',
    icon: Moon,
    href: '/ops/control-nocturno',
    keywords: ['noche', 'nocturno', 'nocturnidad'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-tickets',
    label: 'Tickets',
    description: 'Gestión de tickets operacionales',
    category: 'navigation',
    icon: Ticket,
    href: '/ops/tickets',
    keywords: ['incidencia', 'novedad', 'reporte'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-inventario',
    label: 'Inventario',
    description: 'Control de inventario y activos',
    category: 'navigation',
    icon: Package,
    href: '/ops/inventario',
    keywords: ['bodega', 'stock', 'productos', 'activos'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'nav-ops-supervision',
    label: 'Supervisión',
    description: 'Visitas de supervisión',
    category: 'navigation',
    icon: ClipboardCheck,
    href: '/ops/supervision',
    keywords: ['inspector', 'visita', 'supervisor'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },

  // Personas
  {
    id: 'nav-personas',
    label: 'Guardias',
    description: 'Listado de personal de seguridad',
    category: 'navigation',
    icon: Shield,
    href: '/personas/guardias',
    keywords: ['personal', 'guardias', 'empleados', 'trabajadores'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },

  // Finanzas
  {
    id: 'nav-finanzas',
    label: 'Finanzas',
    description: 'Módulo financiero',
    category: 'navigation',
    icon: Receipt,
    href: '/finanzas',
    keywords: ['finanzas', 'contabilidad', 'dinero'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'nav-finanzas-facturacion',
    label: 'Facturación',
    description: 'Emisión de facturas',
    category: 'navigation',
    icon: FileText,
    href: '/finanzas/facturacion',
    keywords: ['factura', 'dte', 'boleta', 'sii'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'nav-finanzas-rendiciones',
    label: 'Rendiciones',
    description: 'Rendiciones de gastos',
    category: 'navigation',
    icon: Receipt,
    href: '/finanzas/rendiciones',
    keywords: ['gasto', 'reembolso', 'rendicion'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'nav-finanzas-bancos',
    label: 'Bancos',
    description: 'Cuentas bancarias',
    category: 'navigation',
    icon: Landmark,
    href: '/finanzas/bancos',
    keywords: ['banco', 'cuenta', 'cartola'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'nav-finanzas-contabilidad',
    label: 'Contabilidad',
    description: 'Asientos y plan de cuentas',
    category: 'navigation',
    icon: BookText,
    href: '/finanzas/contabilidad',
    keywords: ['asiento', 'contable', 'plan de cuentas'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'nav-finanzas-reportes',
    label: 'Reportes Financieros',
    description: 'Informes y reportes',
    category: 'navigation',
    icon: BarChart3,
    href: '/finanzas/reportes',
    keywords: ['informe', 'reporte', 'balance'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
];

// ── Acciones rápidas ──

const actionCommands: CommandItem[] = [
  {
    id: 'action-turno-extra',
    label: 'Crear turno extra',
    description: 'Programar un turno extraordinario',
    category: 'action',
    icon: Plus,
    href: '/ops/turnos-extra',
    keywords: ['nuevo turno', 'agregar turno', 'extra'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'action-nueva-persona',
    label: 'Agregar nueva persona',
    description: 'Registrar un nuevo guardia',
    category: 'action',
    icon: UserPlus,
    href: '/personas/guardias',
    keywords: ['nuevo guardia', 'registrar personal', 'agregar empleado'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'action-registrar-novedad',
    label: 'Registrar novedad',
    description: 'Crear un ticket de novedad operacional',
    category: 'action',
    icon: Ticket,
    href: '/ops/tickets',
    keywords: ['incidencia', 'novedad', 'reporte', 'nuevo ticket'],
    canShow: (role) => hasAppAccess(role, 'ops'),
  },
  {
    id: 'action-generar-factura',
    label: 'Generar factura',
    description: 'Emitir una nueva factura electrónica',
    category: 'action',
    icon: FilePlus,
    href: '/finanzas/facturacion/emitir',
    keywords: ['facturar', 'emitir dte', 'nueva factura'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'action-crear-cliente',
    label: 'Crear cliente',
    description: 'Registrar nueva cuenta en el CRM',
    category: 'action',
    icon: Building2,
    href: '/crm/accounts',
    keywords: ['nuevo cliente', 'nueva cuenta', 'agregar empresa'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'accounts'),
  },
  {
    id: 'action-nueva-cotizacion',
    label: 'Nueva cotización',
    description: 'Crear un nuevo presupuesto',
    category: 'action',
    icon: DollarSign,
    href: '/crm/cotizaciones',
    keywords: ['presupuesto', 'quote', 'cpq'],
    canShow: (role) => hasCrmSubmoduleAccess(role, 'quotes'),
  },
  {
    id: 'action-nueva-propuesta',
    label: 'Nueva propuesta',
    description: 'Crear documento de propuesta',
    category: 'action',
    icon: FileText,
    href: '/opai/templates',
    keywords: ['crear propuesta', 'documento', 'presentacion'],
    canShow: (role) => hasDocsSubmoduleAccess(role, 'document_editor'),
  },
  {
    id: 'action-exportar-reporte',
    label: 'Exportar reporte',
    description: 'Generar y descargar un reporte',
    category: 'action',
    icon: Download,
    href: '/finanzas/reportes',
    keywords: ['descargar', 'excel', 'pdf', 'exportar'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'action-nueva-rendicion',
    label: 'Nueva rendición',
    description: 'Crear una rendición de gastos',
    category: 'action',
    icon: Receipt,
    href: '/finanzas/rendiciones/nueva',
    keywords: ['gasto', 'rendicion', 'reembolso'],
    canShow: (role) => hasAppAccess(role, 'finance'),
  },
  {
    id: 'action-invitar-usuario',
    label: 'Invitar usuario',
    description: 'Agregar un nuevo usuario al sistema',
    category: 'action',
    icon: UserPlus,
    href: '/opai/configuracion/usuarios',
    keywords: ['nuevo usuario', 'invitar', 'equipo'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'users'),
  },
];

// ── Configuración ──

const configCommands: CommandItem[] = [
  {
    id: 'config-main',
    label: 'Configuración',
    description: 'Ajustes generales del sistema',
    category: 'config',
    icon: Settings,
    href: '/opai/configuracion',
    keywords: ['settings', 'ajustes', 'preferencias'],
    canShow: (role) => hasAnyConfigSubmoduleAccess(role),
  },
  {
    id: 'config-usuarios',
    label: 'Usuarios del sistema',
    description: 'Gestionar usuarios y accesos',
    category: 'config',
    icon: Users,
    href: '/opai/configuracion/usuarios',
    keywords: ['users', 'administrar', 'acceso'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'users'),
  },
  {
    id: 'config-roles',
    label: 'Roles y permisos',
    description: 'Configurar roles y permisos de acceso',
    category: 'config',
    icon: Shield,
    href: '/opai/configuracion/roles',
    keywords: ['permisos', 'roles', 'acceso', 'seguridad'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'users'),
  },
  {
    id: 'config-empresa',
    label: 'Datos de la empresa',
    description: 'Información y parámetros generales',
    category: 'config',
    icon: Building2,
    href: '/opai/configuracion/empresa',
    keywords: ['empresa', 'compania', 'datos', 'parametros'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'users'),
  },
  {
    id: 'config-integraciones',
    label: 'Integraciones',
    description: 'SII, bancos y servicios externos',
    category: 'config',
    icon: Plug,
    href: '/opai/configuracion/integraciones',
    keywords: ['sii', 'banco', 'api', 'servicio', 'integrar'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'integrations'),
  },
  {
    id: 'config-notificaciones',
    label: 'Notificaciones',
    description: 'Configurar alertas y notificaciones',
    category: 'config',
    icon: Bell,
    href: '/opai/configuracion/notificaciones',
    keywords: ['alertas', 'avisos', 'email', 'push'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'notifications'),
  },
  {
    id: 'config-firmas',
    label: 'Firmas',
    description: 'Plantillas de firma para documentos',
    category: 'config',
    icon: PenLine,
    href: '/opai/configuracion/firmas',
    keywords: ['firma', 'firma email', 'signature'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'signatures'),
  },
  {
    id: 'config-categorias-plantillas',
    label: 'Categorías de plantillas',
    description: 'Organizar plantillas de documentos',
    category: 'config',
    icon: FolderTree,
    href: '/opai/configuracion/categorias-plantillas',
    keywords: ['plantilla', 'template', 'categoria'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'doc_categories'),
  },
  {
    id: 'config-crm',
    label: 'Configuración CRM',
    description: 'Campos personalizados y pipelines',
    category: 'config',
    icon: TrendingUp,
    href: '/opai/configuracion/crm',
    keywords: ['pipeline', 'campos', 'etapas'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'crm'),
  },
  {
    id: 'config-ops',
    label: 'Configuración Operaciones',
    description: 'Parámetros de módulo operacional',
    category: 'config',
    icon: ClipboardList,
    href: '/opai/configuracion/ops',
    keywords: ['operaciones', 'parametros ops'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'ops'),
  },
  {
    id: 'config-payroll',
    label: 'Configuración Payroll',
    description: 'Parámetros de remuneraciones',
    category: 'config',
    icon: Calculator,
    href: '/opai/configuracion/payroll',
    keywords: ['remuneraciones', 'liquidacion', 'previred'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'payroll'),
  },
  {
    id: 'config-finanzas',
    label: 'Configuración Finanzas',
    description: 'Parámetros financieros',
    category: 'config',
    icon: Receipt,
    href: '/opai/configuracion/finanzas',
    keywords: ['finanzas', 'contabilidad', 'iva'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'finanzas'),
  },
  {
    id: 'config-asistente-ia',
    label: 'Asistente IA',
    description: 'Configuración del asistente inteligente',
    category: 'config',
    icon: Bot,
    href: '/opai/configuracion/asistente-ia',
    keywords: ['ia', 'inteligencia artificial', 'chatbot', 'ai'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'users'),
  },
  {
    id: 'config-auditoria',
    label: 'Auditoría',
    description: 'Registro de actividad del sistema',
    category: 'config',
    icon: ClipboardCheck,
    href: '/opai/configuracion/auditoria',
    keywords: ['log', 'actividad', 'historial', 'audit'],
    canShow: (role) => hasConfigSubmoduleAccess(role, 'users'),
  },
  {
    id: 'config-modulos',
    label: 'Módulos',
    description: 'Configuración por módulo',
    category: 'config',
    icon: Layers,
    href: '/opai/configuracion',
    keywords: ['modulo', 'activar', 'desactivar'],
    canShow: (role) => hasAnyConfigSubmoduleAccess(role),
  },
];

// ── Exportar todos los comandos ──

/** Todos los comandos por defecto de Opai */
export const defaultCommands: CommandItem[] = [
  ...navigationCommands,
  ...actionCommands,
  ...configCommands,
];

/** Mapa de íconos por nombre (para reconstruir recientes desde localStorage) */
export const ICON_MAP: Record<string, LucideIcon> = {
  Grid3x3,
  FileText,
  Building2,
  Calculator,
  ClipboardList,
  Settings,
  Users,
  CalendarDays,
  UserRoundCheck,
  Receipt,
  Clock3,
  Fingerprint,
  ShieldAlert,
  Route,
  Moon,
  Ticket,
  Package,
  ClipboardCheck,
  Shield,
  DollarSign,
  TrendingUp,
  Contact,
  MapPin,
  Plug,
  Bell,
  Wallet,
  BarChart3,
  Plus,
  UserPlus,
  FilePlus,
  Download,
  Landmark,
  BookText,
  Bot,
  FolderOpen,
  PenLine,
  FolderTree,
  Layers,
};

/** Labels de categorías en español */
export const CATEGORY_LABELS: Record<string, string> = {
  recent: 'Recientes',
  navigation: 'Navegación',
  action: 'Acciones rápidas',
  config: 'Configuración',
};
